!!!
%html{html_attrs('en')}
  %head
    = csrf_meta_tag
    %meta{ 'http-equiv' => 'content-type', 'content' => 'text/html;charset=UTF-8' }
    %meta{ 'name' => 'robots', 'content' => 'noindex, nofollow' }
    %meta{ 'name' => 'SoSOL-Sparql-Endpoint', 'content' => 'http://services.perseids.org/fuseki/ds/query?query='}
    %meta{ 'charset' => 'utf-8' }
    
    %title
      == #{Sosol::Application.config.site_name} Prototype: #{controller.controller_name} - #{controller.action_name}
    = stylesheet_link_tag 'editor'
    = stylesheet_link_tag Sosol::Application.config.site_layout
    = stylesheet_link_tag 'master_additions'
    
    - if controller.controller_name == 'hgv_meta_identifiers' and controller.action_name == 'edit'
      = stylesheet_link_tag 'edit_mask'
      = stylesheet_link_tag 'meta'
      
    - if controller.controller_name == 'biblio_identifiers' and controller.action_name == 'edit'
      = stylesheet_link_tag 'edit_mask'
      = stylesheet_link_tag 'biblio'
      
      // FORK CHANGE START (stylesheet)
    - if controller.controller_name == 'user' and (controller.action_name == 'user_dashboard' or controller.action_name == 'user_community_dashboard')
      = stylesheet_link_tag 'publication_list'
      = javascript_include_tag"dashboard"
      // FORK CHANGE END
    
    -#-------------------------------------------------------------
    -#  includes
    -#-------------------------------------------------------------
    = stylesheet_link_tag Sosol::Application.config.site_layout
    = javascript_include_tag :defaults
    = javascript_include_tag 'http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.js'
    = javascript_include_tag 'perseids-ld'
    = javascript_include_tag 'perseids-tools'
    = javascript_include_tag 'perseids-cite'
    = javascript_include_tag 'perseids-pages'
    
    -#-------------------------------------------------------------
    -#  javascript and styles
    -#-------------------------------------------------------------
    %script
      jQuery.noConflict();
    %script
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-72072451-1', 'auto');
      ga('send', 'pageview');
    %script{:async => '', :src => '//www.google-analytics.com/analytics.js' }

    :javascript 
      (function() {
        if (typeof window.janrain !== 'object') window.janrain = {};
        if (typeof window.janrain.settings !== 'object') window.janrain.settings = {};
   
        janrain.settings.tokenUrl =  "#{url_for(:controller => :rpx, :action => :login_return, :only_path => false)}";

        function isReady() { janrain.ready = true; };
        if (document.addEventListener) {
          document.addEventListener("DOMContentLoaded", isReady, false);
        } else {
          window.attachEvent('onload', isReady);
        }


        var e = document.createElement('script');
        e.type = 'text/javascript';
        e.id = 'janrainAuthWidget';

        if (document.location.protocol === 'https:') {
          e.src = 'https://rpxnow.com/js/lib/perseus-sosol/engage.js';
        } else {
          e.src = 'http://widget-cdn.rpxnow.com/js/lib/perseus-sosol/engage.js';
        }

        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(e, s);
      })();
      // hack to override fixed width on janrain widget items 
      // that causes them to disappear when the browser zoom set to something
      // other than default
      function janrainWidgetOnload() {
        jQuery( '.janrainPage .providers li' ).each(
          function() {
            var style = jQuery(this).attr("style");
            style = style.replace(/width: \d+px !important;/,'width: 10rem;');
            jQuery(this).attr("style",style);
          }
        );
      }   

    %style(type="text/css")
      :sass
        #header
          background: #{defined?(ENVIRONMENT_BACKGROUND) ? ENVIRONMENT_BACKGROUND : '#F0F0F0'}

  -#-------------------------------------------------------------
  -#  body content
  -#-------------------------------------------------------------
  %body

    -#-------------------------------------------------------------
    -#  header
    -#-------------------------------------------------------------
    #header{ :class => (['edit','editxml','commentary','preview','history','finalize_review','rename_review','show','update','show_commit'].include? params[:action]) ? '' : 'basic' }
      .site
        #logo
          %h1= link_to( image_tag('perseids_notag_150.png'), '/' )
          %p= 'Powered by Son of Suda Online'
        -#= render(:partial => 'master_articles/master_article_box')
        -#= render(:partial => 'user/admin_box')
        
        -#-------------------------------------------------------------
        -#  user dashboard
        -#-------------------------------------------------------------
        = render(:partial => 'user/perseids_user_box')
        = render :partial => 'common/flash_all'
        %div{ :style => 'clear:both' }
        
        -#-------------------------------------------------------------
        -# boards
        -#-------------------------------------------------------------
        .nav
          %ul{ :class => 'nav right'} 
            = render "cross_site/board_tabs"
            = render "cross_site/user_tabs"
        %div{ :style => 'clear:both' }
        
        -#-------------------------------------------------------------
        -# Publication selector
        -#-------------------------------------------------------------
        -if ( @current_user && controller.action_name == 'user_dashboard' )
          #cts_selector 
            = render( :partial => 'publications/cts_selector', :locals => { :emend => :showemend, :hide_text => :hide_text, :controller => 'cts_publications' })
            %div{ :style => 'clear:both' }
     
    -#-------------------------------------------------------------
    -#  page content
    -#-------------------------------------------------------------
    .content_body
      = yield
